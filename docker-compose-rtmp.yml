version: '3.8'

services:
  nginx-rtmp:
    image: tiangolo/nginx-rtmp
    ports:
      - "1935:1935"  # RTMP port
      - "8080:80"    # HTTP stats port
    volumes:
      - ./nginx-rtmp.conf:/etc/nginx/nginx.conf:ro
    restart: unless-stopped
    container_name: streamforge-rtmp

  transcoder:
    build:
      context: .
      dockerfile: ./services/transcoder/Dockerfile
    ports:
      - "8083:8083"  # Transcoder API port
    volumes:
      - ./output/hls:/app/output/hls  # HLS output directory
    environment:
      - RTMP_URL=rtmp://nginx-rtmp:1935/live
    depends_on:
      - nginx-rtmp
    restart: unless-stopped
    container_name: streamforge-transcoder 